# Stock Level Monitoring Queries (solutions)

1."What is the total inventory count per product category, and how is it distributed across warehouse regions?"
•Purpose: Identify which categories dominate inventory and regional distribution 


# total  inventory count per product category 


SELECT 
 f.cat_id, c.Category,SUM(f.Inventory_Level ) AS total_inventory 
 FROM final_fact f 
  JOIN 
   dim_cat c 
    USING(cat_id)
     GROUP BY 
        f.cat_id, c.Category
         ORDER BY 
           SUM(f.Inventory_Level )  DESC;



#  total inventory count per category across regions        
 
 SELECT 
 f.cat_id, c.Category,r.Region,SUM(f.Inventory_Level ) AS total_inventory 
 FROM final_fact f 
  JOIN 
   dim_cat c ON f.cat_id=c.cat_id
    JOIN dim_regions r ON f.reg_id=r.Reg_id
     GROUP BY 
        f.cat_id, c.Category,r.Region
         ORDER BY 
          Region ,Category , SUM(f.Inventory_Level ) DESC



2.Fast vs. Slow-Moving Products
"Which products have the highest and lowest sales-to-inventory ratios (indicating fast/slow movers)?"
•	Purpose: Spot potential overstocks (low ratio) and stockout risks (high ratio).


# BASED ON PRODUCT_ID 

WITH CTE AS (Select 
 Product_ID , (SUM(Units_Sold)/SUM(Inventory_Level)) AS stocking_ratio
FROM 
 final_fact 
  GROUP BY 
   Product_ID)
   
   SELECT 
    Product_ID , stocking_ratio,
     CASE 
      WHEN stocking_ratio>=(SELECT AVG(stocking_ratio) FROM CTE ) THEN 'fast-movers'
       WHEN stocking_ratio<(SELECT AVG(stocking_ratio) FROM CTE ) THEN 'slow-movers'
        END AS stock_category
         FROM CTE 
           ORDER BY 
           stocking_ratio DESC


# BASED ON PRODUCT CATEGORY 

WITH CTE AS (Select 
  c.Category , (SUM(f.Units_Sold)/SUM(f.Inventory_Level)) AS stocking_ratio
FROM 
 final_fact f 
  JOIN dim_cat c USING(cat_id)
  GROUP BY 
   c.Category)
   
   SELECT 
	 Category , stocking_ratio,
     CASE 
      WHEN stocking_ratio>=(SELECT AVG(stocking_ratio) FROM CTE ) THEN 'fast-movers'
       WHEN stocking_ratio<(SELECT AVG(stocking_ratio) FROM CTE ) THEN 'slow-movers'
        END AS stock_category
         FROM CTE 
          ORDER BY 
            stocking_ratio DESC

3. Basic Stockout Detection
"Which products currently have inventory levels below forecast  (immediate restock candidates)?"
 • Purpose: Flag urgent replenishment needs.


WITH ranked_inventory AS (
  SELECT 
    Product_ID,
    Inventory_Level,Demand_Forecast,
    Date,
    ROW_NUMBER() OVER (PARTITION BY Product_ID ORDER BY Date DESC) AS rn
  FROM 
    final_fact
),CTE1 AS (
SELECT 
  Product_ID,
  Inventory_Level,
   Demand_Forecast,
  Date
FROM 
  ranked_inventory
WHERE 
  rn = 1)
   SELECT 
  Product_ID ,
  Inventory_Level,
   Demand_Forecast,(Inventory_Level-Demand_Forecast) AS diff 
    FROM CTE1
     WHERE 
      Inventory_Level<Demand_Forecast


# potential chances of stockout (diff<avg_diff):

WITH ranked_inventory AS (
  SELECT 
    Product_ID,
    Inventory_Level,Demand_Forecast,
    Date,
    ROW_NUMBER() OVER (PARTITION BY Product_ID ORDER BY Date DESC) AS rn
  FROM 
    final_fact
),CTE1 AS (
SELECT 
  Product_ID,
  Inventory_Level,
   Demand_Forecast,
  Date
FROM 
  ranked_inventory
WHERE 
  rn = 1)
   SELECT 
  Product_ID ,
  Inventory_Level,
   Demand_Forecast,(Inventory_Level-Demand_Forecast) AS diff 
    FROM CTE1
     WHERE 
      (Inventory_Level-Demand_Forecast)<128.86 
      
4. Regional Stock Comparisons
"How does average inventory level compare between North, South, East, and West warehouses?"
 • Purpose: Reveal imbalances in regional stocking strategies.


 # region wise avg_inventory 

SELECT 
    r.Region,
     AVG(f.Inventory_Level) AS avg_inv
  FROM 
    final_fact f 
     JOIN 
      dim_regions r ON f.Reg_id=r.Reg_id
  GROUP BY 
      r.Region


# region and store wise avg_inventory 


SELECT 
 r.Region,f.Store_ID,AVG(f.Inventory_Level)  AS avg_inv
FROM 
 final_fact f 
  JOIN 
   dim_regions r 
    USING(Reg_ID)
     GROUP BY 
       r.Region,f.Store_ID
        ORDER BY 
         Region , avg_inv DESC



5. Inventory Age Tracking
"Which products have been in inventory for the longest time without being sold?"
• Purpose: Highlight stagnant inventory for clearance decisions.



WITH last_sold_date AS (
  SELECT 
    Product_ID,
    MAX(Date) AS Last_Sold_Date
  FROM final_fact
  WHERE Units_Sold > 0
  GROUP BY Product_ID
),
latest_inventory AS (
  SELECT 
    Product_ID,
    MAX(Date) AS Latest_Date
  FROM final_fact
  GROUP BY Product_ID
)
SELECT 
  li.Product_ID,
  li.Latest_Date,
  ls.Last_Sold_Date,
  DATEDIFF(li.Latest_Date, ls.Last_Sold_Date) AS Days_Without_Sale
FROM 
  latest_inventory li
LEFT JOIN 
  last_sold_date ls ON li.Product_ID = ls.Product_ID
ORDER BY 
  Days_Without_Sale DESC;



# products unsold for >30 days, grouped by category to spot dead-stock patterns - no  products found 

WITH last_sold AS (
  SELECT 
    Product_ID,
    MAX(Date) AS Last_Sold_Date
  FROM final_fact
  WHERE Units_Sold > 0
  GROUP BY Product_ID
),
latest_inventory_info AS (
  SELECT 
    f1.Product_ID,
    c.Category,
    MAX(f1.Date) AS Latest_Date
  FROM final_fact f1
   JOIN dim_cat c USING(cat_id)
  GROUP BY f1.Product_ID, c.Category
),
inventory_age AS (
  SELECT 
    li.Product_ID,
    li.Category,
    ls.Last_Sold_Date,
    li.Latest_Date,
    DATEDIFF(li.Latest_Date, ls.Last_Sold_Date) AS Days_Unsold
  FROM last_sold ls
  JOIN latest_inventory_info li ON ls.Product_ID = li.Product_ID
)
SELECT 
  Category,
  COUNT(Product_ID) AS Dead_Stock_Count,
  GROUP_CONCAT(Product_ID) AS Product_List
FROM inventory_age
WHERE Days_Unsold > 30
GROUP BY Category
ORDER BY Dead_Stock_Count DESC;

6.  Cross-Region Inventory Imbalance
"Which SKUs are overstocked in one region but understocked in another, requiring inter-warehouse transfers?"


WITH CTE AS (SELECT 
 r.Region ,f.Product_ID, SUM(f.Inventory_Level) as total_stock
FROM 
 dim_regions r 
  JOIN final_fact f USING(Reg_id)
   GROUP BY 
    r.region ,f.Product_ID
     ORDER BY r.Region)
     
     SELECT *
      FROM 
       CTE a 
        JOIN 
         CTE b ON a.Product_ID=b.Product_ID AND 
          a.Region!=b.Region

7.  Dynamic Safety Stock Calculator
"What is the optimal safety stock level per SKU, considering demand variability and lead time?"
• Uses: Statistical functions (STDDEV, AVG) + conditional thresholds.(assuming the lead time is 7 days )

SELECT 
  Product_ID,
  ROUND(1.65 * STDDEV(Units_Sold) * SQRT(7), 2) AS Safety_Stock_Level
FROM 
  final_fact
GROUP BY 
  Product_ID;


#  "Which stores have the most SKUs with inventory levels below their demand forecast?"


SELECT 
 Store_ID, Inventory_Level, Demand_Forecast
FROM 
 final_fact 
  WHERE 
   YEAR(Date)=2024 AND 
    Inventory_Level<Demand_Forecast
